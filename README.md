Node.js Application with PostgreSQL and WebSocket Integration

Overview

This Node.js application demonstrates a layered architecture with route, controller, service, and model layers. The app integrates with PostgreSQL for CRUD operations and establishes a WebSocket connection to fetch real-time price data. Logging is enabled using Winston for effective monitoring.

Features

Layered Architecture: Clean separation of concerns with routes, controllers, services, and models.

PostgreSQL Integration: Supports inserting, updating, and retrieving symbol data.

WebSocket Integration: Fetches real-time price updates from an external API and pushes them to the frontend.

Logging: Robust logging with Winston, including log rotation.

Startup Service: Fetches metadata and initial price data for symbols on server startup.

Prerequisites

Node.js: v20 or later

PostgreSQL: v12 or later

npm: v6 or later

Installation

Clone the repository:

git clone https://github.com/ChamithMendis/market-data-v1.git

cd market-data-v1

Install dependencies:

npm install

Set up PostgreSQL:

Using pg admin Create a database named "marketDB"

Right click on "marketDB" and select Query tool and run below scripts

CREATE TABLE public.symbol_data (
id integer NOT NULL,
ticker character varying,
description character varying,
start_date date,
end_date date,
name character varying,
exchange_code character varying
);

ALTER TABLE public.symbol_data ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
SEQUENCE NAME public.market_data_id_seq
START WITH 1
INCREMENT BY 1
NO MINVALUE
NO MAXVALUE
CACHE 1
);

CREATE TABLE public.symbol_price_data (
ticker character varying,
date date,
open numeric(10,4),
close numeric(10,4),
high numeric(10,4),
low numeric(10,4),
market numeric(10,4)
);

ALTER TABLE ONLY public.symbol_data ADD CONSTRAINT market_data_pkey PRIMARY KEY (id);

ALTER TABLE ONLY public.symbol_data ADD CONSTRAINT symbol_data_unique_key_ticker UNIQUE (ticker);

ALTER TABLE ONLY public.symbol_price_data ADD CONSTRAINT symbol_price_data_unique_key_ticker UNIQUE (ticker);

Update database credentials in models/marketModel.js:

const pool = new Pool({
user: 'your_db_user',
host: 'localhost',
database: 'marketDB',
password: 'your_db_password',
port: 5432,
});

Usage

Running the Application

Start the server:

npm start

The server will run on http://localhost:3000 by default.

The following actions are performed at startup:

Retrieve metadata and prices for predefined symbols.

Establish a WebSocket connection to fetch real-time price data.

API Endpoints

Use Postman to call API endpoints

REST END POINTS

http://localhost:3000/market/test - To check if the postman to backend requests are functioning

To all the rest endpoints regarding market data please use below key value pairs in the headers. You can use your own tocken from tiingo API as wish

Content-Type: application/json,
Authorization: Token 16568609525e84e3550bab3c4110a221678b24a9,

http://localhost:3000/market/getSymbol/<symbol_name> - To get the symbol meta data from tiingo api (use aapl as examble symbol_name)
http://localhost:3000/market/getSymbolPriceData/<symbol_name> - To get the symbol price data from tiingo api (use aapl as examble symbol_name)
http://localhost:3000/market/getSymbolHistoryData/<symbol_name> - To get the symbol price data from tiingo api (use aapl as examble symbol_name), configure startDate and endDate as wish in the body of the request as a json
http://localhost:3000/market/getSymbolHistoryDataToCsv/<symbol_name> - To extract the symbol price data from tiingo api to excel (use aapl as examble symbol_name), configure startDate and endDate as wish in the body of the request as a json
http://localhost:3000/market/getSavedSymbols - To get all the saved symbols from postgre db
http://localhost:3000/market/getSymbolByName/<symbol_name> - To get the saved symbol data by symbol name (use aapl as examble symbol_name)
http://localhost:3000/market/getSavedSymbolPriceData/<symbol_name> - To get the saved symbol price data by symbol name (use aapl as examble symbol_name)

WEBSOCKET END POINT

At the start of the application subscription to the twelvedata endpoint will happen to get real time sotck price data. Details will display in the console.

You can use your own twelvedata tocken key as wish

wss://ws.twelvedata.com/v1/quotes/price/?apikey=1aca76ec7f534a8d95215897537aa7f8

Logging

Logs are stored in the logs/ directory.

Error Logs: Stored in logs/error.log

Combined Logs: Stored in logs/combined.log

File Structure

Dependencies

express: Web framework for Node.js

pg: PostgreSQL client for Node.js

winston: Logging library
